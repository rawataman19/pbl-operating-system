<!DOCTYPE html>
<html>
<head>
  <title>Deadlock Detection</title>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    #network { width: 100%; height: 400px; border: 1px solid gray; margin-top: 10px; }
    input, button, select { margin: 5px; }
  </style>
</head>
<body>

<h3>🔗 Deadlock Detection in Resource Allocation Graph</h3>

<!-- Input Section -->
<input type="text" id="from" placeholder="From (e.g., P1)">
<input type="text" id="to" placeholder="To (e.g., R1)">
<select id="type">
  <option value="request">Request</option>
  <option value="allocation">Allocation</option>
</select>
<br>
<button onclick="addEdge()">Add Edge</button>
<button onclick="deleteEdge()">Delete Edge</button>
<button onclick="detectDeadlock()">Detect Deadlock</button>
<button onclick="resetGraph()">Reset Graph</button>

<!-- Graph and Result -->
<div id="network"></div>
<p id="result"></p>

<script>
  const nodes = new vis.DataSet();
  const edges = new vis.DataSet();
  const graph = {}; // adjacency list

  const container = document.getElementById("network");
  const data = { nodes, edges };
  const options = {
    edges: { arrows: 'to', font: { align: 'top' } },
    nodes: { shape: 'ellipse' }
  };
  const network = new vis.Network(container, data, options);

  // Add Edge Function
  function addEdge() {
    const from = document.getElementById("from").value.trim();
    const to = document.getElementById("to").value.trim();
    const type = document.getElementById("type").value;
    const id = from + "_" + to;

    if (!from || !to || from === to) return;

    if (!nodes.get(from)) nodes.add({ id: from, label: from });
    if (!nodes.get(to)) nodes.add({ id: to, label: to });

    if (!edges.get(id)) {
      edges.add({ id, from, to, label: type });
      if (!graph[from]) graph[from] = [];
      graph[from].push(to);
    }

    document.getElementById("result").innerText = "";
  }

  // Delete Edge Function
  function deleteEdge() {
    const from = document.getElementById("from").value.trim();
    const to = document.getElementById("to").value.trim();
    const id = from + "_" + to;

    if (edges.get(id)) {
      edges.remove(id);
      if (graph[from]) {
        graph[from] = graph[from].filter(v => v !== to);
        if (graph[from].length === 0) delete graph[from];
      }
      document.getElementById("result").innerText = "🗑️ Edge deleted.";
    } else {
      document.getElementById("result").innerText = "⚠️ Edge not found.";
    }
  }

  // Deadlock Detection
  function detectDeadlock() {
    const visited = {}, recStack = {};
    function dfs(node) {
      visited[node] = true;
      recStack[node] = true;
      for (const neighbor of (graph[node] || [])) {
        if (!visited[neighbor] && dfs(neighbor)) return true;
        else if (recStack[neighbor]) return true;
      }
      recStack[node] = false;
      return false;
    }

    for (const node of nodes.getIds()) {
      if (!visited[node]) {
        if (dfs(node)) {
          document.getElementById("result").innerText = "🔴 Deadlock Detected!";
          return;
        }
      }
    }
    document.getElementById("result").innerText = "✅ No Deadlock Detected.";
  }

  // Reset Graph
  function resetGraph() {
    nodes.clear();
    edges.clear();
    for (let key in graph) delete graph[key];
    document.getElementById("result").innerText = "🔄 Graph reset.";
  }
</script>

</body>
</html>
